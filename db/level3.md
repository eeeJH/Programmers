# ***LEVEL 3***



## 없어진 기록 찾기

```sql
SELECT ANIMAL_ID, NAME
FROM ANIMAL_OUTS
WHERE (ANIMAL_ID, NAME) NOT IN (
	SELECT ANIMAL_ID,NAME
	FROM ANIMAL_INS
);
```



## 있었는데요 없었습니다

```sql
SELECT i.ANIMAL_ID, i.NAME
FROM ANIMAL_INS i
JOIN ANIMAL_OUTS o ON i.ANIMAL_ID = o.ANIMAL_ID
WHERE i.DATETIME > o.DATETIME
ORDER BY i.DATETIME;
```



## 오랜 기간 보호한 동물(1)

```sql
SELECT i.NAME, i.DATETIME
FROM ANIMAL_INS i
LEFT JOIN ANIMAL_OUTS o ON i.ANIMAL_ID = o.ANIMAL_ID
WHERE o.ANIMAL_ID IS NULL
ORDER BY DATETIME
LIMIT 3;
```



## 헤비 유저가 소유한 장소

```sql
SELECT B.ID, B.NAME, B.HOST_ID
FROM PLACES B
JOIN (
    SELECT HOST_ID
    FROM PLACES
    GROUP BY HOST_ID
    HAVING COUNT(*) > 1
)A ON A.HOST_ID = B.HOST_ID
ORDER BY NAME;
```



## 오랜 기간 보호한 동물(2)

```sql
SELECT D.ANIMAL_ID, D.NAME
FROM (
    SELECT B.ANIMAL_ID, B.NAME, (B.DATETIME - A.DATETIME) C
    FROM ANIMAL_INS A, ANIMAL_OUTS B
    WHERE (B.DATETIME - A.DATETIME) > 0 && A.ANIMAL_ID = B.ANIMAL_ID && B.DATETIME IS NOT NULL
    ORDER BY C DESC
) D
LIMIT 2;
```

```sql
SELECT ID, NAME
FROM (
    SELECT I.ANIMAL_ID ID, I.NAME NAME
    FROM ANIMAL_INS I, ANIMAL_OUTS O
    WHERE I.ANIMAL_ID = O.ANIMAL_ID
    ORDER BY (O.DATETIME - I.DATETIME) DESC
)
WHERE ROWNUM < 3;
```

